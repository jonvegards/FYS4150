MC = [100000, 200000, 300000, 400000, 500000, 600000, 700000, 800000, 900000, 1e+06, 1.1e+06, 1.2e+06, 1.3e+06, 1.4e+06, 1.5e+06, 1.6e+06, 1.7e+06, 1.8e+06, 1.9e+06, 2e+06, 2.1e+06, 2.2e+06, 2.3e+06, 2.4e+06, 2.5e+06, 2.6e+06, 2.7e+06, 2.8e+06, 2.9e+06, 3e+06, 3.1e+06, 3.2e+06, 3.3e+06, 3.4e+06, 3.5e+06, 3.6e+06, 3.7e+06, 3.8e+06, 3.9e+06, 4e+06, 4.1e+06, 4.2e+06, 4.3e+06, 4.4e+06, 4.5e+06, 4.6e+06, 4.7e+06, 4.8e+06, 4.9e+06, 5e+06, 5.1e+06, 5.2e+06, 5.3e+06, 5.4e+06, 5.5e+06, 5.6e+06, 5.7e+06, 5.8e+06, 5.9e+06, 6e+06, 6.1e+06, 6.2e+06, 6.3e+06, 6.4e+06, 6.5e+06, 6.6e+06, 6.7e+06, 6.8e+06, 6.9e+06, 7e+06, 7.1e+06, 7.2e+06, 7.3e+06, 7.4e+06, 7.5e+06, 7.6e+06, 7.7e+06, 7.8e+06, 7.9e+06, 8e+06, 8.1e+06, 8.2e+06, 8.3e+06, 8.4e+06, 8.5e+06, 8.6e+06, 8.7e+06, 8.8e+06, 8.9e+06, 9e+06, 9.1e+06, 9.2e+06, 9.3e+06, 9.4e+06, 9.5e+06, 9.6e+06, 9.7e+06, 9.8e+06, 9.9e+06, 1e+07, ];
e_var = [0.0268348, 0.0300234, 0.0299172, 0.0316571, 0.032191, 0.0312188, 0.0315034, 0.0320555, 0.0319714, 0.0323663, 0.0321678, 0.0324937, 0.0320096, 0.032084, 0.0323078, 0.0322248, 0.0325265, 0.0325557, 0.0329592, 0.0329797, 0.0329073, 0.0327255, 0.0325457, 0.0325203, 0.032344, 0.032175, 0.0322193, 0.0322775, 0.0322932, 0.0322282, 0.0322084, 0.0322896, 0.0321292, 0.0322547, 0.0321955, 0.0320511, 0.0321298, 0.032087, 0.03203, 0.0322069, 0.0321848, 0.0320233, 0.0319508, 0.0318853, 0.0318793, 0.0319117, 0.0317563, 0.0316671, 0.0318417, 0.0318754, 0.0319329, 0.0319758, 0.0318909, 0.031936, 0.0318896, 0.0318421, 0.0317738, 0.0317574, 0.0318685, 0.0318643, 0.0318733, 0.031918, 0.0320852, 0.0321427, 0.0321272, 0.0320012, 0.0321096, 0.0321352, 0.032227, 0.0322615, 0.0322592, 0.0322326, 0.0322787, 0.0322332, 0.0321506, 0.0321205, 0.0321388, 0.0321587, 0.0321175, 0.0320356, 0.0320698, 0.0320429, 0.032055, 0.0320612, 0.0321891, 0.0321639, 0.0321192, 0.0320772, 0.0320363, 0.0320086, 0.0320096, 0.0319914, 0.0319891, 0.0319394, 0.0320081, 0.0320074, 0.0319738, 0.0319344, 0.0319312, 0.0319408, ];
m_var = [0.00341489, 0.00374872, 0.00377703, 0.0040753, 0.00405472, 0.00395312, 0.00399726, 0.00409643, 0.00408827, 0.00414053, 0.00411534, 0.00413501, 0.00405353, 0.00405917, 0.00408996, 0.00407143, 0.004119, 0.00410311, 0.00414239, 0.00415935, 0.0041405, 0.00410387, 0.0040878, 0.00410298, 0.00407745, 0.0040581, 0.0040627, 0.00406483, 0.00404788, 0.00404406, 0.00404499, 0.00405676, 0.00402763, 0.00405447, 0.00405329, 0.00403251, 0.00404411, 0.00403988, 0.00402947, 0.00405422, 0.00404688, 0.00403185, 0.00401772, 0.00400992, 0.003998, 0.00399485, 0.0039719, 0.00396425, 0.00398843, 0.00399729, 0.00400091, 0.00400421, 0.00399215, 0.00400564, 0.00400052, 0.00399327, 0.00398907, 0.00398656, 0.00399764, 0.0039969, 0.00399601, 0.00400175, 0.0040293, 0.00403215, 0.00403001, 0.00401057, 0.00402667, 0.00402719, 0.00403536, 0.00404287, 0.00404498, 0.00403802, 0.00404272, 0.00403396, 0.00402385, 0.00401793, 0.00401903, 0.00401946, 0.00401344, 0.0040031, 0.00400678, 0.00400041, 0.00400561, 0.0040114, 0.00403206, 0.00402615, 0.00401568, 0.00400658, 0.00400004, 0.00399509, 0.0040022, 0.00400177, 0.00400361, 0.00399703, 0.00400422, 0.00400296, 0.00399875, 0.00399513, 0.00399712, 0.00399928, ];
mean_mag = [0.99887, 0.998748, 0.998745, 0.998659, 0.998651, 0.998688, 0.998675, 0.998647, 0.99865, 0.998633, 0.998641, 0.998631, 0.998655, 0.998653, 0.998643, 0.998648, 0.998633, 0.998635, 0.99862, 0.998617, 0.998622, 0.998632, 0.998638, 0.998636, 0.998644, 0.998651, 0.998649, 0.998648, 0.99865, 0.998652, 0.998652, 0.998649, 0.998657, 0.99865, 0.998651, 0.998658, 0.998654, 0.998656, 0.998659, 0.998651, 0.998652, 0.998658, 0.998662, 0.998665, 0.998667, 0.998667, 0.998674, 0.998677, 0.998669, 0.998667, 0.998665, 0.998664, 0.998668, 0.998665, 0.998666, 0.998669, 0.998671, 0.998671, 0.998667, 0.998668, 0.998667, 0.998666, 0.998657, 0.998656, 0.998656, 0.998662, 0.998657, 0.998657, 0.998653, 0.998652, 0.998651, 0.998653, 0.998651, 0.998654, 0.998657, 0.998659, 0.998658, 0.998658, 0.998659, 0.998663, 0.998662, 0.998663, 0.998662, 0.998661, 0.998655, 0.998656, 0.998659, 0.998661, 0.998663, 0.998665, 0.998664, 0.998664, 0.998664, 0.998666, 0.998663, 0.998663, 0.998665, 0.998666, 0.998666, 0.998665, ];
time_used = [0.069621, 0.142336, 0.212596, 0.279609, 0.344169, 0.408298, 0.475745, 0.543918, 0.610429, 0.681202, 0.751358, 0.818808, 0.884417, 0.950249, 1.02004, 1.08954, 1.15995, 1.22675, 1.292, 1.35673, 1.42203, 1.48812, 1.55105, 1.61881, 1.68611, 1.75195, 1.82125, 1.88994, 1.95276, 2.01558, 2.08469, 2.1507, 2.21825, 2.28325, 2.34694, 2.41518, 2.47793, 2.54052, 2.60354, 2.66866, 2.73471, 2.80048, 2.86346, 2.92628, 2.99034, 3.05613, 3.12526, 3.19075, 3.25879, 3.32755, 3.39093, 3.45398, 3.51994, 3.58589, 3.65181, 3.71667, 3.78542, 3.85575, 3.9191, 3.98724, 4.05332, 4.11869, 4.18467, 4.25214, 4.31813, 4.3842, 4.4501, 4.51793, 4.58333, 4.64889, 4.71429, 4.77868, 4.84725, 4.91264, 4.97531, 5.04298, 5.11347, 5.18032, 5.24646, 5.31348, 5.38291, 5.44883, 5.51455, 5.58262, 5.64867, 5.71615, 5.78546, 5.84828, 5.91732, 5.98653, 6.05971, 6.129, 6.1982, 6.26515, 6.33045, 6.39907, 6.46664, 6.53297, 6.59978, 6.67068, ];
accepted_states = [0.00682, 0.00434, 0.00260667, 0.00224, 0.001796, 0.0011, 0.00122, 0.0010725, 0.000875556, 0.00089, 0.000687273, 0.000731667, 0.000518462, 0.000612857, 0.000574667, 0.00048375, 0.000557647, 0.000448889, 0.000507368, 0.000408, 0.000358095, 0.000348182, 0.000309565, 0.000326667, 0.0002856, 0.000286923, 0.000312593, 0.000301429, 0.000281379, 0.000256667, 0.000263871, 0.000285, 0.00019697, 0.000260588, 0.000216, 0.000184444, 0.000231892, 0.000202105, 0.000190769, 0.0002425, 0.000197561, 0.00015619, 0.000165581, 0.000167273, 0.000180889, 0.000172174, 0.000137021, 0.0001425, 0.000195918, 0.0001728, 0.000169412, 0.000166538, 0.000133585, 0.000155185, 0.000135636, 0.000132857, 0.000127018, 0.00012931, 0.000149831, 0.000136, 0.00013541, 0.000147097, 0.000167937, 0.000136562, 0.000121538, 8.72727e-05, 0.000145672, 0.000125, 0.000138551, 0.000121429, 0.00011831, 0.000105556, 0.000121096, 0.000106216, 9.78667e-05, 9.73684e-05, 0.000107792, 0.000106154, 8.91139e-05, 8.35e-05, 0.000105679, 8.92683e-05, 0.000100482, 0.000100238, 0.000125176, 8.7907e-05, 8.16092e-05, 8.40909e-05, 8.29213e-05, 7.88889e-05, 9.45055e-05, 8.56522e-05, 8.47312e-05, 7.3617e-05, 9.72632e-05, 8.64583e-05, 7.4433e-05, 7.36735e-05, 7.93939e-05, 8.64e-05, ];
probability = [-8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ];
avg_energy = [-7.98656, -7.98496, -7.98501, -7.98414, -7.98387, -7.98436, -7.98422, -7.98394, -7.98398, -7.98378, -7.98388, -7.98372, -7.98396, -7.98393, -7.98381, -7.98386, -7.9837, -7.98369, -7.98349, -7.98348, -7.98351, -7.9836, -7.98369, -7.98371, -7.9838, -7.98388, -7.98386, -7.98383, -7.98382, -7.98385, -7.98386, -7.98382, -7.9839, -7.98384, -7.98387, -7.98394, -7.9839, -7.98392, -7.98395, -7.98386, -7.98388, -7.98396, -7.98399, -7.98403, -7.98403, -7.98401, -7.98409, -7.98414, -7.98405, -7.98403, -7.984, -7.98398, -7.98402, -7.984, -7.98402, -7.98405, -7.98408, -7.98409, -7.98403, -7.98404, -7.98403, -7.98401, -7.98393, -7.9839, -7.9839, -7.98397, -7.98391, -7.9839, -7.98385, -7.98384, -7.98384, -7.98385, -7.98383, -7.98385, -7.98389, -7.98391, -7.9839, -7.98389, -7.98391, -7.98395, -7.98393, -7.98395, -7.98394, -7.98394, -7.98387, -7.98389, -7.98391, -7.98393, -7.98395, -7.98396, -7.98396, -7.98397, -7.98397, -7.984, -7.98396, -7.98396, -7.98398, -7.984, -7.984, -7.984, ];

ran_e_var = [0.0269943, 0.0307407, 0.0307141, 0.0318165, 0.0326372, 0.0313517, 0.0313441, 0.0317169, 0.0316173, 0.0320157, 0.0317911, 0.0319626, 0.0315069, 0.0317766, 0.0320635, 0.031926, 0.0322922, 0.0323078, 0.0326992, 0.0326929, 0.0325582, 0.0324358, 0.0322339, 0.0320887, 0.0319233, 0.0318379, 0.0319714, 0.0320157, 0.0320129, 0.0319572, 0.0319617, 0.0321452, 0.0319553, 0.0320532, 0.0320043, 0.0317988, 0.0318542, 0.031806, 0.0316949, 0.0318842, 0.0318932, 0.0317539, 0.0316617, 0.0315774, 0.0315535, 0.0315826, 0.0314172, 0.0313384, 0.0315392, 0.0315631, 0.0316329, 0.031697, 0.0316504, 0.031694, 0.0316579, 0.0316173, 0.0315698, 0.0315294, 0.0315822, 0.031604, 0.0315964, 0.0316713, 0.031802, 0.0318414, 0.0318208, 0.0316801, 0.0318028, 0.0318587, 0.0319429, 0.0319383, 0.031945, 0.0319316, 0.0319971, 0.0319855, 0.0319445, 0.0319255, 0.0319546, 0.0319789, 0.0318997, 0.0318344, 0.031875, 0.031835, 0.0318611, 0.0318905, 0.0320241, 0.0320101, 0.0319635, 0.0319306, 0.0319056, 0.031867, 0.0318817, 0.0318875, 0.0318829, 0.0318309, 0.031889, 0.0319111, 0.0318802, 0.0318563, 0.0318475, 0.0318834, ];
ran_m_var = [0.00357462, 0.00397319, 0.00394657, 0.00406279, 0.00410054, 0.00399635, 0.00400871, 0.00406406, 0.00404953, 0.00410068, 0.00405917, 0.00406692, 0.00398531, 0.00403571, 0.00405874, 0.00402471, 0.00408147, 0.004071, 0.0041167, 0.00411749, 0.00410017, 0.00407626, 0.00406573, 0.00406606, 0.00404759, 0.00403821, 0.00404834, 0.00404956, 0.00403968, 0.00403115, 0.0040238, 0.00404213, 0.00401769, 0.00403837, 0.00403537, 0.00400346, 0.00400909, 0.00399239, 0.00397554, 0.00400188, 0.00399509, 0.00397938, 0.00396765, 0.00395939, 0.00394839, 0.00394501, 0.00392398, 0.00390817, 0.00393043, 0.00393887, 0.0039499, 0.003958, 0.00394888, 0.00396281, 0.00395829, 0.00395196, 0.00394586, 0.00393825, 0.00394678, 0.0039522, 0.00395173, 0.00396606, 0.00398595, 0.00398808, 0.00398416, 0.00396103, 0.00398294, 0.00398792, 0.00399419, 0.00399703, 0.00399795, 0.00399553, 0.00399848, 0.00399301, 0.00399462, 0.00398803, 0.00399081, 0.00398981, 0.00398393, 0.00397445, 0.00397651, 0.00396881, 0.00397186, 0.00397579, 0.00399569, 0.00399183, 0.00398359, 0.00397701, 0.00397035, 0.00396462, 0.00397316, 0.00397478, 0.00397798, 0.00396891, 0.00397693, 0.00397855, 0.00397592, 0.00397345, 0.00397587, 0.00398282, ];
ran_mean_mag = [0.99884, 0.998695, 0.9987, 0.998657, 0.998634, 0.998678, 0.998676, 0.998659, 0.998664, 0.998647, 0.998659, 0.998654, 0.998677, 0.998663, 0.998653, 0.998662, 0.998644, 0.998646, 0.99863, 0.99863, 0.998636, 0.998642, 0.998648, 0.998651, 0.998658, 0.998661, 0.998657, 0.998656, 0.998657, 0.99866, 0.998661, 0.998654, 0.998662, 0.998657, 0.998658, 0.998668, 0.998666, 0.998669, 0.998675, 0.998666, 0.998667, 0.998673, 0.998677, 0.99868, 0.998682, 0.998682, 0.998689, 0.998693, 0.998685, 0.998683, 0.99868, 0.998677, 0.99868, 0.998677, 0.998678, 0.99868, 0.998682, 0.998684, 0.998682, 0.998681, 0.998681, 0.998677, 0.998671, 0.99867, 0.998671, 0.998677, 0.998671, 0.998669, 0.998666, 0.998666, 0.998666, 0.998666, 0.998665, 0.998666, 0.998666, 0.998668, 0.998667, 0.998666, 0.998669, 0.998672, 0.998671, 0.998673, 0.998672, 0.998671, 0.998664, 0.998665, 0.998668, 0.99867, 0.998671, 0.998673, 0.998671, 0.998671, 0.99867, 0.998673, 0.99867, 0.99867, 0.998671, 0.998672, 0.998671, 0.99867, ];
ran_accepted_states = [0.00681, 0.00434, 0.00260667, 0.00224, 0.001796, 0.0011, 0.00122, 0.0010725, 0.000875556, 0.00089, 0.000687273, 0.000731667, 0.000518462, 0.000612857, 0.000574667, 0.00048375, 0.000557647, 0.000448889, 0.000507368, 0.000408, 0.000358095, 0.000348182, 0.000309565, 0.000326667, 0.0002856, 0.000286923, 0.000312593, 0.000301429, 0.000281379, 0.000256667, 0.000263871, 0.000285, 0.00019697, 0.000260588, 0.000216, 0.000184444, 0.000231892, 0.000202105, 0.000190769, 0.0002425, 0.000197561, 0.00015619, 0.000165581, 0.000167273, 0.000180889, 0.000172174, 0.000137021, 0.0001425, 0.000195918, 0.0001728, 0.000169412, 0.000166538, 0.000133585, 0.000155185, 0.000135636, 0.000132857, 0.000127018, 0.00012931, 0.000149831, 0.000136, 0.00013541, 0.000147097, 0.000167937, 0.000136562, 0.000121538, 8.72727e-05, 0.000145672, 0.000125, 0.000138551, 0.000121429, 0.00011831, 0.000105556, 0.000121096, 0.000106216, 9.78667e-05, 9.73684e-05, 0.000107792, 0.000106154, 8.91139e-05, 8.35e-05, 0.000105679, 8.92683e-05, 0.000100482, 0.000100238, 0.000125176, 8.7907e-05, 8.16092e-05, 8.40909e-05, 8.29213e-05, 7.88889e-05, 9.45055e-05, 8.56522e-05, 8.47312e-05, 7.3617e-05, 9.72632e-05, 8.64583e-05, 7.4433e-05, 7.36735e-05, 7.93939e-05, 8.64e-05, ];
ran_probability = [0, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ];
ran_avg_energy = [-1.99662, -1.99615, -1.99615, -1.99602, -1.99591, -1.99607, -1.99607, -1.99603, -1.99604, -1.99599, -1.99602, -1.996, -1.99605, -1.99602, -1.99598, -1.996, -1.99596, -1.99595, -1.9959, -1.99591, -1.99592, -1.99594, -1.99596, -1.99598, -1.996, -1.99601, -1.996, -1.99599, -1.99599, -1.996, -1.996, -1.99597, -1.996, -1.99599, -1.99599, -1.99602, -1.99601, -1.99602, -1.99603, -1.99601, -1.99601, -1.99602, -1.99603, -1.99605, -1.99605, -1.99604, -1.99607, -1.99608, -1.99605, -1.99605, -1.99604, -1.99603, -1.99604, -1.99603, -1.99604, -1.99604, -1.99605, -1.99605, -1.99605, -1.99604, -1.99604, -1.99603, -1.99602, -1.99601, -1.99602, -1.99603, -1.99602, -1.99601, -1.996, -1.996, -1.996, -1.996, -1.99599, -1.99599, -1.996, -1.996, -1.996, -1.996, -1.99601, -1.99601, -1.99601, -1.99601, -1.99601, -1.99601, -1.99599, -1.99599, -1.996, -1.996, -1.996, -1.99601, -1.99601, -1.99601, -1.99601, -1.99601, -1.99601, -1.996, -1.99601, -1.99601, -1.99601, -1.99601, ];

sh = sinh(8);
ch = cosh(8);
energy_analytical = (-8*sh) / (ch + 3);
heat_capacity_analytical = 64*( ch / (ch + 3) - sh*sh / ( (ch + 3)^2) );
z = 4*ch + 12;
susceptibility_analytical = 1/z*( 32*exp(8) + 32 )/4 - (1/(z^2))*( 8*exp(8)+16 )^2 /16
mean_mag_analytical = (( (1/(4*ch + 12)) * ( 8*exp(8) + 16 ) )^2) /16

diff_e = (e_var*4 - heat_capacity_analytical)./heat_capacity_analytical;
diff_m = (m_var*4 - susceptibility_analytical)./susceptibility_analytical;
diff_energy = (avg_energy - energy_analytical)./energy_analytical;

std(e_var)
std(m_var)
std(mean_mag)
std(avg_energy)

%Plotting results
figure(1)
plot(MC, m_var, MC, ran_m_var)
legend('Ordered','Random')
title('Susceptibilitet \chi som funksjon av MC-sykluser, T=1','FontSize',16)
xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
ylabel('Susceptibilitet','FontSize',16)
set(0,'DefaultAxesFontSize',15)


figure(2)
plot(MC, e_var, MC, ran_e_var)
legend('Ordered','Random')
title('Varmekapasitet C_V som funksjon av MC-sykluser, T=1','FontSize',16)
xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
ylabel('Varmekapasitet','FontSize',16)

figure(3)
plot(MC,diff_e)
title('Relativ feil for varmekapasitet (C_V), T=1','FontSize',16)
xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
ylabel('Relativ feil \epsilon_{C_V}','FontSize',16)

figure(4)
plot(MC,diff_m)
title('Relativ feil for susceptibilitet (\chi), T=1','FontSize',16)
xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
ylabel('Relativ feil \epsilon_{\chi}','FontSize',16)

%figure(5)
%plot(MC,avg_energy, MC, ran_avg_energy)
%title('Gjennomsnittlig energi som funksjon av MC-sykluser, T=1','FontSize',16)
%xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
%ylabel('\langle E \rangle','FontSize',16)

figure(6)
plot(MC,diff_energy)
title('Relativ feil for gjennomsnittlig energi, T=1','FontSize',16)
xlabel('Ant. Monte Carlo-sykluser','FontSize',16)
ylabel('\epsilon_{\langle E \rangle}','FontSize',16)